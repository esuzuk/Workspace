# 米国株売買タイミング推奨アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
米国株式の売買タイミングを推奨するアプリケーションを開発し、ユーザーが適切なタイミングで株式の売買判断を行えるよう支援する。

### 1.2 対象ユーザー
- 米国株式を保有している、または保有を検討している個人投資家
- データに基づいた売買判断を求めている投資家

## 2. 機能要件

### 2.1 データ取得機能
- **データソース**: 米国Yahoo Finance（無料API）
- **取得データ**:
  - 株価（現在価格、過去の価格データ）
  - 出来高
  - テクニカル指標（移動平均線、RSI、MACD等）
  - 財務データ（P/E、P/B、ROE、EPS、キャッシュフロー等）
  - 財務諸表（損益計算書、貸借対照表、キャッシュフロー計算書）
- **更新頻度**: 1日1回（市場終了後）、またはリアルタイム（可能な範囲で）

### 2.2 保有株式管理機能
以下の情報を登録・管理できること：
- **銘柄情報**: ティッカーシンボル（例: AAPL, MSFT）
- **取得数**: 保有株数
- **取得単価**: 1株あたりの取得価格
- **取得価格**: 取得単価 × 取得数
- **現在の単価**: Yahoo Financeから取得した最新の株価
- **現在の価格**: 現在の単価 × 取得数
- **損益**: 現在の価格 - 取得価格
- **損益率**: (損益 / 取得価格) × 100

### 2.3 Google Spreadsheet連携機能
- **データ保存先**: Google Spreadsheet
- **シート構成**:
  - 保有株式一覧シート
  - 売買推奨履歴シート
  - データ取得ログシート
- **認証**: Google Service AccountまたはOAuth2を使用
- **データの透明性**: すべてのデータソースと計算過程を記録

### 2.4 売りタイミング推奨機能
保有株式について、以下の条件を満たす場合に売り推奨通知を送信：
- **判定基準（テクニカル分析）**:
  - テクニカル指標による判定（RSI、MACD、移動平均線の乖離率等）
  - 利益確定タイミング（一定の利益率に達した場合）
  - 損切りタイミング（一定の損失率に達した場合）
  - トレンド転換の兆候
- **判定基準（ファンダメンタル分析）**:
  - バリュー投資視点：割高評価になった場合（安全余裕がなくなった場合）
  - 長期投資視点：優良企業の場合は長期保有を推奨（売り推奨を抑制）
  - 財務健全性の悪化
- **通知内容**:
  - 推奨銘柄
  - 推奨理由（根拠データと判定ロジック）
  - 現在の価格情報
  - 推奨売却価格
  - 賢人のアドバイス（投資哲学に基づく推奨）

### 2.5 買いタイミング推奨機能
保有していない株式について、以下の条件を満たす場合に買い推奨通知を送信：
- **判定基準（テクニカル分析）**:
  - テクニカル指標による判定（RSI、MACD、移動平均線の位置関係等）
  - 底値圏での買いシグナル
  - ブレイクアウトシグナル
  - トレンド転換の兆候
- **判定基準（ファンダメンタル分析）**:
  - バリュー投資視点：安全余裕が十分な場合（割安判定）
  - 長期投資視点：優良企業の判定（ROE、キャッシュフロー等）
  - CAN SLIM視点：成長性が高い場合（四半期利益成長、新高値等）
  - 広瀬のプロトコル：営業CFマージン15%以上、過去3年成長等
- **通知内容**:
  - 推奨銘柄
  - 推奨理由（根拠データと判定ロジック）
  - 現在の価格情報
  - 推奨買い価格帯
  - 賢人のアドバイス（投資哲学に基づく推奨）

### 2.6 根拠提示機能
すべての売買推奨について、以下の情報を明確に提示：
- **使用したデータ（テクニカル）**:
  - 株価データ（期間、価格範囲）
  - テクニカル指標の値（RSI、MACD、移動平均線等）
  - 出来高データ
- **使用したデータ（ファンダメンタル）**:
  - 財務指標（P/E、P/B、ROE、EPS等）
  - キャッシュフロー情報
  - 成長率データ（過去3年）
- **判定ロジック**:
  - 使用した指標の組み合わせ
  - 閾値や条件
  - 判定結果の信頼度
  - 投資哲学に基づく判定理由
- **投資哲学統合分析**:
  - ベンジャミン・グレアムのバリュー投資判定
  - ウォーレン・バフェットの長期投資判定
  - ウィリアム・J・オニールのCAN SLIM判定
  - 広瀬隆雄のプロトコル判定
  - 統合判定と賢人のアドバイス
- **可視化**:
  - チャート表示（可能な範囲で）
  - 指標の数値表示
  - 投資哲学レポート（詳細分析）

### 2.7 投資哲学レポート機能
各銘柄について、4人の投資家の哲学に基づいた詳細レポートを生成：
- **ベンジャミン・グレアム**: 安全余裕、P/E、P/B、ROEによる割安判定
- **ウォーレン・バフェット**: 優良企業の選別、長期保有推奨
- **ウィリアム・J・オニール**: CAN SLIMメソッド（四半期利益成長、新高値等）
- **広瀬隆雄**: 広瀬のプロトコル（営業CFマージン、過去3年成長率等）
- **統合判定**: 4つの投資哲学を統合した総合判定

## 3. 非機能要件

### 3.1 パフォーマンス
- データ取得処理: 1銘柄あたり1秒以内
- 判定処理: 全保有銘柄の判定を5分以内に完了

### 3.2 セキュリティ
- Google Spreadsheetの認証情報は環境変数で管理
- APIキーや認証情報はコードに直接記載しない

### 3.3 可用性
- Yahoo Finance APIのレート制限を考慮した実装
- エラーハンドリングとリトライ機能

### 3.4 保守性
- コードはモジュール化し、各機能を独立してテスト可能にする
- ログ出力機能を実装し、デバッグを容易にする

## 4. 技術要件

### 4.1 使用技術
- **言語**: Python 3.8以上
- **主要ライブラリ**:
  - `yfinance`: Yahoo Financeデータ取得
  - `gspread`: Google Spreadsheet連携
  - `pandas`: データ処理
  - `numpy`: 数値計算
  - `ta-lib`または`pandas-ta`: テクニカル分析

### 4.2 実行環境
- ローカル環境またはクラウド環境（Google Colab、AWS Lambda等）

### 4.3 スケジュール実行
- 定期実行: cronジョブまたはスケジューラーで1日1回実行

## 5. データ構造

### 5.1 保有株式データ
```python
{
    "ticker": "AAPL",
    "shares": 10,
    "purchase_price_per_share": 150.0,
    "purchase_date": "2024-01-15",
    "current_price": 175.0,
    "profit_loss": 250.0,
    "profit_loss_rate": 16.67
}
```

### 5.2 売買推奨データ
```python
{
    "ticker": "AAPL",
    "recommendation_type": "SELL",  # or "BUY"
    "recommendation_date": "2024-12-30",
    "current_price": 175.0,
    "recommended_price": 175.0,
    "reason": "RSI overbought | 利益確定目標達成",
    "data_source": {
        "rsi": 75.5,
        "macd": 2.5,
        "moving_average_50": 170.0,
        "moving_average_200": 165.0,
        "fundamental": {
            "pe_ratio": 28.5,
            "pb_ratio": 45.2,
            "roe": 150.8
        }
    },
    "logic": "RSIが70を超えており、過買い状態。利益確定を推奨。",
    "confidence": 0.75,
    "philosopher_advice": [
        "ベンジャミン・グレアム: 割高評価のため売却を検討",
        "ウォーレン・バフェット: 優良企業のため長期保有を推奨（売り推奨を抑制）"
    ]
}
```

## 6. 実装フェーズ

### Phase 1: 基盤構築
- プロジェクト構造の作成
- 必要なライブラリのインストール
- 基本的なデータ取得機能の実装

### Phase 2: データ管理
- Google Spreadsheet連携機能の実装
- 保有株式管理機能の実装

### Phase 3: 分析機能
- テクニカル指標の計算機能
- 売買タイミング判定ロジックの実装

### Phase 4: 通知機能
- 通知機能の実装
- 根拠提示機能の実装

### Phase 5: ファンダメンタル分析機能
- 財務データ取得機能の実装
- 財務指標計算機能の実装
- 内在価値計算機能の実装

### Phase 6: 投資哲学統合機能
- 各投資家の哲学に基づく判定ロジックの実装
- 統合判定システムの実装
- 投資哲学レポート生成機能の実装

### Phase 7: 統合とテスト
- 全体の統合
- テストとデバッグ
- ドキュメント作成

## 7. 制約事項

### 7.1 Yahoo Finance API
- 無料版のレート制限に注意
- APIの仕様変更に備えた実装

### 7.2 Google Spreadsheet
- スプレッドシートの作成と共有設定が必要
- 認証情報の管理が必要

### 7.3 投資判断の免責
- 本アプリは投資判断の支援ツールであり、投資の最終判断はユーザー自身が行う
- 投資損失について一切の責任を負わない

## 8. 実装済み機能（Version 2.0）

### 8.1 投資哲学統合分析
- ✅ ベンジャミン・グレアムのバリュー投資判定
- ✅ ウォーレン・バフェットの長期投資判定
- ✅ ウィリアム・J・オニールのCAN SLIM判定
- ✅ 広瀬隆雄のプロトコル判定
- ✅ 統合判定システム

### 8.2 ファンダメンタル分析
- ✅ 財務指標取得（P/E、P/B、ROE、EPS、キャッシュフロー等）
- ✅ 内在価値計算（PER法、PBR法、DCF法）
- ✅ 安全余裕（マージン・オブ・セーフティ）計算
- ✅ 過去3年の成長率分析

### 8.3 投資哲学レポート
- ✅ 各投資家の視点からの詳細レポート生成
- ✅ 統合判定と賢人のアドバイス表示

## 9. 今後の拡張可能性

- 複数のテクニカル指標の組み合わせ最適化
- 機械学習による予測モデルの追加
- メールやSlack等への通知機能
- Webアプリケーション化
- モバイルアプリ化
- より詳細な財務分析（DCF法の高度化等）
- 業界比較機能の追加