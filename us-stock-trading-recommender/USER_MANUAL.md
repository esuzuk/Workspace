# 米国株売買タイミング推奨アプリ 利用マニュアル

## 目次

1. [はじめに](#はじめに)
2. [インストールとセットアップ](#インストールとセットアップ)
3. [基本的な使い方](#基本的な使い方)
4. [機能詳細](#機能詳細)
5. [判定ロジックの説明](#判定ロジックの説明)
6. [Google Spreadsheet連携](#google-spreadsheet連携)
7. [定期実行の設定](#定期実行の設定)
8. [よくある質問（FAQ）](#よくある質問faq)
9. [トラブルシューティング](#トラブルシューティング)
10. [注意事項と免責事項](#注意事項と免責事項)

---

## はじめに

### アプリの概要

本アプリは、米国株式の売買タイミングを推奨するツールです。Yahoo Financeから取得したデータを基に、テクニカル分析とファンダメンタル分析を統合し、4人の著名な投資家の哲学に基づいて売買のタイミングを判断します。

### 主な機能

- **保有株式管理**: 保有している株式の情報を登録・管理
- **価格更新**: リアルタイムで株価を更新
- **売り推奨**: 保有株式の売りタイミングを通知（テクニカル + ファンダメンタル統合）
- **買い推奨**: 保有していない株式の買いタイミングを通知（テクニカル + ファンダメンタル統合）
- **根拠提示**: 推奨の根拠となるデータとロジックを明確に表示
- **投資哲学統合分析**: 4人の投資家の哲学に基づいた包括的な分析
  - ベンジャミン・グレアム（バリュー投資）
  - ウォーレン・バフェット（長期投資）
  - ウィリアム・J・オニール（CAN SLIM）
  - 広瀬隆雄（広瀬のプロトコル）
- **投資哲学レポート**: 各投資家の視点からの詳細レポート生成
- **Google Spreadsheet連携**: データをスプレッドシートで管理（オプション）

### 対象ユーザー

- 米国株式を保有している、または保有を検討している個人投資家
- データに基づいた売買判断を求めている投資家
- Pythonの基本的な操作ができる方

---

## インストールとセットアップ

### 必要な環境

- **Python 3.8以上**がインストールされていること
- **インターネット接続**（Yahoo Financeからデータを取得するため）

### インストール手順

#### ステップ1: プロジェクトディレクトリに移動

```bash
cd /Users/esuzuki/Documents/Workspace/06_Project/us-stock-trading-recommender
```

#### ステップ2: 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

インストールされる主なライブラリ：
- `yfinance`: Yahoo Financeデータ取得
- `gspread`: Google Spreadsheet連携
- `pandas`: データ処理
- `pandas-ta`: テクニカル分析

#### ステップ3: 動作確認

```bash
python main.py --help
```

ヘルプが表示されれば、インストールは成功です。

### Google Spreadsheet連携の設定（オプション）

Google Spreadsheet連携を使用する場合は、追加の設定が必要です。詳細は[Google Spreadsheet連携](#google-spreadsheet連携)セクションを参照してください。

---

## 基本的な使い方

### コマンド一覧

```bash
# ヘルプを表示
python main.py --help

# 保有株式を登録
python main.py --register TICKER SHARES PRICE

# 価格を更新
python main.py --update

# 売買シグナルをチェック
python main.py --check

# 特定銘柄の買いシグナルをチェック
python main.py --check --watch TICKER1 TICKER2 ...

# 保有株式一覧を表示
python main.py --portfolio

# 投資哲学レポートを生成
python main.py --philosophy-report TICKER
```

# 定期実行（価格更新＋シグナルチェック）
python main.py --daily-check
```

### 使用例

#### 例1: 保有株式を登録する

Apple（AAPL）を10株、1株あたり$150.00で購入した場合：

```bash
python main.py --register AAPL 10 150.0
```

取得日を指定する場合：

```bash
python main.py --register AAPL 10 150.0 --purchase-date 2024-01-15
```

**実行結果例：**
```
保有株式を登録しました:
  銘柄: AAPL
  保有株数: 10
  取得単価: $150.00
  現在価格: $175.50
  損益: $255.00 (17.00%)
```

#### 例2: 保有株式の価格を更新する

```bash
python main.py --update
```

**実行結果例：**
```
価格更新を開始します...
価格を更新しました: AAPL = $175.50
価格を更新しました: MSFT = $380.25
価格更新が完了しました: 2銘柄
```

#### 例3: 売買シグナルをチェックする

保有株式の売りシグナルと、指定した銘柄の買いシグナルをチェック：

```bash
python main.py --check --watch AAPL MSFT GOOGL
```

**実行結果例：**
```
売り推奨: 1件

╔═══════════════════════════════════════════════════════════╗
║              【売り推奨通知】                              ║
╚═══════════════════════════════════════════════════════════╝

銘柄: AAPL
現在価格: $175.50
推奨売却価格: $175.50
信頼度: 75.0%

【推奨理由】
利益確定目標達成（20.00%） | RSI過買い状態（RSI: 72.50）

【判定ロジック】
以下の複数の指標が売りシグナルを示しています: 利益確定目標達成（20.00%）、RSI過買い状態（RSI: 72.50）

【使用したデータ】
  - RSI: 72.50
  - MACD: 2.15
  - 20日移動平均: $170.25
  - 50日移動平均: $165.80

通知日時: 2024-12-30 15:30:00
```

#### 例4: 保有株式一覧を表示する

```bash
python main.py --portfolio
```

**実行結果例：**
```
================================================================================
保有株式一覧
================================================================================
銘柄        株数      取得単価    現在価格        損益      損益率
--------------------------------------------------------------------------------
AAPL           10.00  $150.00  $175.50  $255.00    17.00%
MSFT            5.00  $300.00  $380.25  $401.25    26.75%
GOOGL           8.00  $120.00  $135.50  $124.00    12.92%
--------------------------------------------------------------------------------
合計                $1,500.00  $2,890.00  $1,390.00    92.67%
================================================================================
```

#### 例5: 投資哲学レポートを生成する

```bash
python main.py --philosophy-report AAPL
```

**実行結果例：**
```
╔═══════════════════════════════════════════════════════════╗
║        投資哲学統合レポート - AAPL                        ║
╚═══════════════════════════════════════════════════════════╝

企業名: Apple Inc.
業種: Technology / Consumer Electronics
現在価格: $175.50

【統合判定】
推奨: BUY
信頼度: 72.5%

============================================================

【ベンジャミン・グレアム - バリュー投資】
推奨: BUY
信頼度: 65.0%

推奨理由:
  ✓ 安全余裕が十分（PER法: 35.2%）
  ✓ PERが割安（14.5倍）
  ✓ ROEが高い（150.8%）

主要指標:
  - PER: 14.5
  - PBR: 45.2
  - ROE: 150.8%
  - 安全余裕（PER法）: 35.2%

============================================================

【ウォーレン・バフェット - 長期投資】
推奨: BUY_AND_HOLD
信頼度: 80.0%

推奨理由:
  ✓ 優良企業（ROE: 150.8%）
  ✓ 利益成長が持続（25.5%）
  ✓ 営業キャッシュフローが良好（$110,543,000,000）
  ✓ 長期保有に適した優良企業

...

【賢人の総合アドバイス】

ベンジャミン・グレアム:
  安全余裕が十分（PER法: 35.2%） | PERが割安（14.5倍） | ROEが高い（150.8%）

ウォーレン・バフェット:
  優良企業（ROE: 150.8%） | 利益成長が持続（25.5%） | 長期保有に適した優良企業

...
```

---

## 機能詳細

### 1. 保有株式の登録

#### コマンド形式

```bash
python main.py --register TICKER SHARES PRICE [--purchase-date DATE]
```

#### パラメータ

- `TICKER`: ティッカーシンボル（例: AAPL, MSFT, GOOGL）
- `SHARES`: 保有株数（数値）
- `PRICE`: 取得単価（1株あたりの価格）
- `--purchase-date`: 取得日（YYYY-MM-DD形式、オプション）

#### 使用例

```bash
# 基本的な登録
python main.py --register AAPL 10 150.0

# 取得日を指定
python main.py --register MSFT 5 300.0 --purchase-date 2024-01-15
```

#### 注意点

- 同じティッカーを複数回登録すると、既存のデータが更新されます
- ティッカーシンボルは大文字・小文字を区別しません（自動的に大文字に変換されます）

### 2. 価格更新

#### コマンド形式

```bash
python main.py --update
```

#### 機能

- 登録されているすべての保有株式の現在価格を取得
- 損益と損益率を自動計算
- Google Spreadsheetを使用している場合、データを自動更新

#### 実行時間

- 1銘柄あたり約1秒程度
- 10銘柄で約10秒程度

### 3. 売買シグナルチェック

#### コマンド形式

```bash
# 保有株式の売りシグナルのみチェック
python main.py --check

# 保有株式の売りシグナル + 指定銘柄の買いシグナルをチェック
python main.py --check --watch TICKER1 TICKER2 ...
```

#### 機能

- 保有株式について売りシグナルをチェック
- 指定した銘柄について買いシグナルをチェック
- 推奨がある場合、詳細な根拠を表示
- 推奨結果をファイルに保存（`recommendations_YYYYMMDD_HHMMSS.txt`）

### 4. 保有株式一覧表示

#### コマンド形式

```bash
python main.py --portfolio
```

#### 表示内容

- 各銘柄の詳細情報（銘柄、株数、取得単価、現在価格、損益、損益率）
- ポートフォリオ全体の合計情報

### 5. 定期実行

#### コマンド形式

```bash
python main.py --daily-check
```

#### 機能

- 価格更新と売買シグナルチェックを一度に実行
- cronジョブやタスクスケジューラーで定期実行する際に使用

### 6. 投資哲学レポート生成

#### コマンド形式

```bash
python main.py --philosophy-report TICKER
```

#### 機能

- 指定した銘柄について、4人の投資家の視点から詳細な分析レポートを生成
- 各投資哲学の判定結果、推奨理由、主要指標を表示
- 統合判定と賢人のアドバイスを表示
- レポートはファイルにも保存される（`philosophy_report_TICKER_YYYYMMDD_HHMMSS.txt`）

---

## 判定ロジックの説明

本アプリは、**テクニカル分析**と**ファンダメンタル分析**を統合し、さらに**4人の著名な投資家の哲学**に基づいて判定を行います。

### テクニカル分析による判定

#### 売りシグナル

以下の条件のいずれかが満たされた場合、売り推奨が表示されます：

##### 1. 利益確定・損切り判定

- **利益確定目標**: 利益率が+20%以上に達した場合
- **損切りライン**: 損失率が-10%以下に達した場合

##### 2. RSI（相対力指数）判定

- **過買い状態**: RSIが70以上の場合
- RSIは0〜100の値で、70以上は「買われすぎ」を示します

##### 3. MACD判定

- **売りシグナル**: MACDがシグナルラインを下回り、ヒストグラムが負の値の場合
- MACDはトレンドの転換点を捉える指標です

##### 4. 移動平均線判定

- **デッドクロス**: 20日移動平均が50日移動平均を2%以上下回る場合
- **200日移動平均**: 現在価格が200日移動平均を5%以上下回る場合

##### 5. ボリンジャーバンド判定

- **上限到達**: 現在価格がボリンジャーバンドの上限に到達した場合
- ボリンジャーバンドは価格の変動幅を示す指標です

#### 買いシグナル

以下の条件のいずれかが満たされた場合、買い推奨が表示されます：

##### 1. RSI（相対力指数）判定

- **過売り状態**: RSIが30以下の場合
- RSIが30以下は「売られすぎ」を示します

##### 2. MACD判定

- **買いシグナル**: MACDがシグナルラインを上回り、ヒストグラムが正の値の場合

##### 3. 移動平均線判定

- **ゴールデンクロス**: 20日移動平均が50日移動平均を2%以上上回る場合
- **200日移動平均**: 現在価格が200日移動平均を上回る場合

##### 4. ボリンジャーバンド判定

- **下限到達**: 現在価格がボリンジャーバンドの下限に到達した場合

##### 5. 出来高判定

- **出来高急増**: 現在の出来高が20日移動平均の1.5倍以上の場合
- 出来高の急増は、市場の関心の高まりを示します

### ファンダメンタル分析による判定

#### ベンジャミン・グレアム - バリュー投資

グレアムは「安全余裕（マージン・オブ・セーフティ）」を重視しました。

- **安全余裕**: 内在価値に対して現在価格が30%以上割安な場合に推奨
- **P/E判定**: PERが15倍以下を理想とする
- **P/B判定**: PBRが1.5倍以下を理想とする
- **ROE判定**: ROEが15%以上を理想とする
- **財務健全性**: 負債比率が低く、流動比率が2.0以上を推奨

#### ウォーレン・バフェット - 長期投資

バフェットは優良企業の長期保有を重視しました。

- **優良企業の判定**: ROEが15%以上、利益成長が持続
- **キャッシュフロー**: 営業キャッシュフローとフリーキャッシュフローが良好
- **財務健全性**: 負債が少ない企業を推奨
- **長期保有推奨**: 優良企業の場合は売り推奨を抑制

#### ウィリアム・J・オニール - CAN SLIM

オニールは成長株投資を重視しました。

- **C（四半期利益）**: 四半期利益成長率が25%以上
- **A（年間利益成長）**: 年間利益成長率が25%以上
- **N（新高値）**: 52週高値に近い価格（95%以上）
- **S（需給）**: 出来高の急増
- **L（リーダー）**: 業界リーダー（ROE 20%以上）

#### 広瀬隆雄 - 広瀬のプロトコル

広瀬は実践的な投資手法を重視しました。

- **営業CFマージン**: 15%以上を推奨
- **過去3年の成長**: EPS、営業CF、売上高が毎年増加
- **粉飾リスク検出**: 一株あたり営業CF > EPS を確認
- **過去最高値**: 過去最高値更新が投資チャンス

### 統合判定システム

本アプリは、上記のテクニカル分析と4つの投資哲学を統合して判定します。

- **統合判定**: 4つの投資哲学の推奨を集計
- **賢人のアドバイス**: 各投資家の視点からの推奨理由を表示
- **信頼度**: 複数の指標と投資哲学が一致するほど信頼度が高くなる

### 信頼度について

- 信頼度は0.0（0%）〜0.95（95%）の範囲で表示されます
- 複数の指標が同じ方向を示すほど、信頼度が高くなります
- テクニカル分析とファンダメンタル分析が一致する場合、信頼度がさらに高くなります
- 信頼度が50%以上の場合に推奨が表示されます

---

## Google Spreadsheet連携

### 概要

Google Spreadsheetと連携することで、以下のメリットがあります：

- データの透明性のある管理
- 複数デバイスからのアクセス
- データのバックアップ
- 推奨履歴の記録

### セットアップ手順

#### ステップ1: Google Cloud Consoleでプロジェクトを作成

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成（または既存のプロジェクトを選択）

#### ステップ2: APIを有効化

1. 「APIとサービス」→「ライブラリ」に移動
2. "Google Sheets API"を検索して有効化
3. "Google Drive API"も有効化

#### ステップ3: サービスアカウントを作成

1. 「APIとサービス」→「認証情報」に移動
2. 「認証情報を作成」→「サービスアカウント」を選択
3. サービスアカウント名を入力して作成
4. 作成したサービスアカウントをクリック
5. 「キー」タブ→「キーを追加」→「JSONを作成」
6. ダウンロードしたJSONファイルを`credentials.json`としてプロジェクトルートに配置

#### ステップ4: スプレッドシートを作成と共有設定

1. [Google Sheets](https://sheets.google.com/)で新しいスプレッドシートを作成
2. スプレッドシートのURLからIDを取得
   - URL例: `https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit`
   - `SPREADSHEET_ID`の部分をコピー
3. スプレッドシートの「共有」ボタンをクリック
4. サービスアカウントのメールアドレスを入力
   - `credentials.json`ファイルを開き、`client_email`の値を確認
5. 「編集者」権限を付与して共有

#### ステップ5: 環境変数の設定

`.env`ファイルを作成し、以下を設定：

```bash
GOOGLE_SPREADSHEET_ID=your_spreadsheet_id_here
GOOGLE_CREDENTIALS_PATH=credentials.json
```

### スプレッドシートの構成

アプリは自動的に以下のシートを作成・管理します：

#### Portfolioシート

保有株式の一覧を管理します。

| 列名 | 説明 |
|------|------|
| Ticker | ティッカーシンボル |
| Shares | 保有株数 |
| Purchase Price per Share | 取得単価 |
| Purchase Date | 取得日 |
| Current Price | 現在価格 |
| Current Value | 現在価値 |
| Profit/Loss | 損益 |
| Profit/Loss Rate (%) | 損益率 |
| Last Updated | 最終更新日時 |

#### Recommendationsシート

売買推奨の履歴を記録します。

| 列名 | 説明 |
|------|------|
| Date | 推奨日時 |
| Ticker | ティッカーシンボル |
| Type | 推奨タイプ（SELL/BUY） |
| Current Price | 現在価格 |
| Recommended Price | 推奨価格 |
| Reason | 推奨理由 |
| RSI | RSI値 |
| MACD | MACD値 |
| Logic | 判定ロジック |
| Confidence | 信頼度 |

#### Data Logsシート

データ取得のログを記録します。

---

## 定期実行の設定

### Linux/Mac (cron)

#### 基本的な設定

1. crontabを編集：

```bash
crontab -e
```

2. 以下の行を追加（毎日午後6時に実行）：

```bash
0 18 * * * cd /path/to/us-stock-trading-recommender && python main.py --daily-check >> daily_check.log 2>&1
```

#### 実行時間の調整

- `0 18 * * *`: 毎日18時（午後6時）
- `0 9 * * 1-5`: 平日の9時（月〜金）
- `0 */6 * * *`: 6時間ごと

### Windows (タスクスケジューラー)

1. タスクスケジューラーを開く
2. 「基本タスクの作成」を選択
3. タスク名を入力（例: "Stock Trading Check"）
4. トリガーを「毎日」に設定
5. 開始時刻を設定（例: 18:00）
6. 操作を「プログラムの開始」に設定
7. プログラム: `python`（または`python3`）
8. 引数: `main.py --daily-check`
9. 開始場所: プロジェクトのパス（例: `C:\Users\YourName\Documents\us-stock-trading-recommender`）

---

## よくある質問（FAQ）

### Q1: どのティッカーシンボルが使えますか？

A: Yahoo Financeで取得可能なすべての米国株式のティッカーシンボルが使用できます。例：
- AAPL (Apple)
- MSFT (Microsoft)
- GOOGL (Google)
- AMZN (Amazon)
- TSLA (Tesla)

### Q2: データはどのくらいの頻度で更新されますか？

A: Yahoo Financeからリアルタイムで取得しますが、市場が開いている時間帯の方が正確なデータが取得できます。市場終了後は前日の終値が表示されます。

### Q3: Google Spreadsheet連携は必須ですか？

A: いいえ、オプションです。Google Spreadsheet連携なしでも、アプリの基本機能はすべて使用できます。

### Q4: 複数のポートフォリオを管理できますか？

A: 現在のバージョンでは、1つのポートフォリオのみ管理できます。複数のポートフォリオを管理する場合は、異なるスプレッドシートを使用するか、手動で管理してください。

### Q5: 判定ロジックをカスタマイズできますか？

A: `trading_signal.py`ファイルを編集することで、判定パラメータを調整できます。ただし、コードの知識が必要です。

### Q6: エラーが発生した場合はどうすればいいですか？

A: [トラブルシューティング](#トラブルシューティング)セクションを参照してください。それでも解決しない場合は、エラーメッセージの内容を確認してください。

### Q7: 投資哲学レポートとは何ですか？

A: 4人の著名な投資家（グレアム、バフェット、オニール、広瀬）の視点から、銘柄を詳細に分析したレポートです。各投資家の推奨、信頼度、推奨理由、主要指標が表示されます。

### Q8: テクニカル分析とファンダメンタル分析のどちらが重要ですか？

A: 本アプリは両方を統合して判定します。テクニカル分析は短期的な売買タイミングを、ファンダメンタル分析は企業の本質的価値を評価します。両方が一致する場合、より信頼度の高い推奨となります。

### Q9: 賢人のアドバイスはどのように表示されますか？

A: 売買推奨通知に「【賢人のアドバイス】」セクションとして表示されます。各投資家の視点からの推奨理由が表示されます。

---

## トラブルシューティング

### エラー1: "データが取得できませんでした"

**原因:**
- ティッカーシンボルが間違っている
- インターネット接続の問題
- Yahoo Finance APIのレート制限

**対処法:**
1. ティッカーシンボルが正しいか確認
2. インターネット接続を確認
3. しばらく待ってから再試行

### エラー2: "認証情報ファイルが見つかりません"

**原因:**
- `credentials.json`ファイルが存在しない
- ファイルパスが間違っている

**対処法:**
1. `credentials.json`ファイルがプロジェクトルートにあるか確認
2. `.env`ファイルの`GOOGLE_CREDENTIALS_PATH`を確認

### エラー3: "Google Spreadsheet接続エラー"

**原因:**
- サービスアカウントにスプレッドシートへのアクセス権限がない
- スプレッドシートIDが間違っている

**対処法:**
1. スプレッドシートの共有設定を確認
2. サービスアカウントのメールアドレスが正しく共有されているか確認
3. `.env`ファイルの`GOOGLE_SPREADSHEET_ID`を確認

### エラー4: "ModuleNotFoundError"

**原因:**
- 必要なライブラリがインストールされていない

**対処法:**
```bash
pip install -r requirements.txt
```

### エラー5: 価格が更新されない

**原因:**
- 市場が閉まっている（週末や祝日）
- ティッカーシンボルが無効

**対処法:**
1. 市場の営業時間を確認
2. ティッカーシンボルが正しいか確認

---

## 注意事項と免責事項

### 重要な注意事項

1. **投資判断の最終責任**
   - 本アプリは投資判断の**支援ツール**です
   - 最終的な投資判断は**ユーザー自身**が行う必要があります
   - アプリの推奨を盲目的に信頼しないでください

2. **データの正確性**
   - Yahoo Financeからのデータを使用していますが、データの正確性については保証しません
   - 必ず複数の情報源で確認してください

3. **投資損失の責任**
   - 本アプリを使用した結果生じた投資損失について、一切の責任を負いません
   - 投資は自己責任で行ってください

4. **APIの制限**
   - Yahoo Finance APIは無料ですが、レート制限があります
   - 過度なリクエストは避けてください

5. **テクニカル分析の限界**
   - テクニカル分析は過去のデータに基づくものであり、将来の価格を保証するものではありません
   - 市場は予測不可能な動きをすることがあります

### 推奨事項

1. **分散投資**
   - 1つの銘柄に集中投資しない
   - リスクを分散させる

2. **定期的な見直し**
   - ポートフォリオを定期的に見直す
   - 投資目標に合わせて調整する

3. **情報の収集**
   - 本アプリだけでなく、他の情報源も活用する
   - 企業の財務状況やニュースも確認する

4. **リスク管理**
   - 損切りラインを設定する
   - 投資可能な資金の範囲内で取引する

---

## サポートとフィードバック

### 問題報告

問題が発生した場合：
1. エラーメッセージの内容を記録
2. 実行したコマンドを記録
3. 環境情報（OS、Pythonバージョン等）を記録

### 改善提案

機能改善の提案や要望がある場合は、プロジェクトのリポジトリにIssueを作成してください。

---

**最終更新日**: 2024年12月30日

**バージョン**: 1.0.0
